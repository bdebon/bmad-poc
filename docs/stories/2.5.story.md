# Story 2.5: Sortie en Français - Brownfield Addition

## Status

Done

## Story

**As a** Benjamin (utilisateur final),
**I want** les titres et descriptions générés par Claude en français,
**So that** je percute immédiatement sur le sujet sans effort de traduction mentale.

## Story Context

**Existing System Integration:**

- Intègre avec : `prompts/benjamin-profile.md` et `src/analyzer/`
- Technology : Claude API, TypeScript
- Suit le pattern : Prompt-based output formatting (Story 2.2)
- Touch points : Fichier prompt uniquement

## Acceptance Criteria

**Functional Requirements:**

1. Le champ `justification` dans la réponse Claude est rédigé en français
2. Les tags restent en anglais (pour cohérence technique)
3. Les anglicismes tech sont acceptés dans le texte français (ex: "layoffs", "framework", "open source")
4. Le champ `rejectionReason` est également en français

**Integration Requirements:**

5. Le format JSON de sortie reste identique (pas de changement de structure)
6. Les tests existants de l'analyzer continuent de passer
7. Le scoring n'est pas impacté par le changement de langue

**Quality Requirements:**

8. Le prompt mis à jour est validé avec un test manuel sur 2-3 posts
9. Pas de régression sur les autres fonctionnalités

## Tasks / Subtasks

- [x] Task 1: Modifier le prompt benjamin-profile.md (AC: 1, 2, 3, 4)

  - [x] Ajouter section "Langue de Sortie" avec instruction explicite FR
  - [x] Préciser que les tags restent en anglais
  - [x] Autoriser les anglicismes tech

- [x] Task 2: Mettre à jour les exemples JSON (AC: 1, 4)

  - [x] Traduire l'exemple "Post très pertinent" en français (déjà en FR)
  - [x] Traduire l'exemple "Post rejeté" en français (déjà en FR)

- [x] Task 3: Validation (AC: 5, 6, 7, 8, 9)

  - [x] Exécuter les tests existants (`npm run test`)
  - [ ] Test manuel sur 2-3 posts réels
  - [x] Vérifier que le JSON reste parseable

## Technical Notes

### Changements Proposés au Prompt

Ajouter après la section "Format de Sortie" :

```markdown
### Langue de Sortie

**IMPORTANT:** Rédige TOUJOURS la `justification` et `rejectionReason` en **français**.
Les anglicismes tech sont acceptés (layoffs, framework, open source, etc.).
Les `tags` restent en anglais pour la cohérence technique.
```

### Fichiers Impactés

- `prompts/benjamin-profile.md` (modification)

### Dépendances Stories Précédentes

- **Story 2.2 (Benjamin Profile Prompt)** - le prompt à modifier

## Definition of Done

- [x] Prompt `benjamin-profile.md` mis à jour avec instruction de langue FR
- [x] Exemples JSON dans le prompt traduits en français
- [ ] Test manuel validé sur 2-3 posts
- [x] Tests existants passent toujours (tests analyzer: 22/22 ✓, prompt-loader: 6/6 ✓)

## Risk Assessment

- **Primary Risk:** Claude pourrait parfois mélanger FR/EN
- **Mitigation:** Instruction explicite et exemples clairs en français
- **Rollback:** Revert du fichier prompt uniquement

## Change Log

| Date       | Version | Description   | Author    |
| ---------- | ------- | ------------- | --------- |
| 2025-12-11 | 0.1     | Initial draft | John (PM) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Completion Notes List

- Added "Langue de Sortie" section to `benjamin-profile.md` with instructions for French output
- Added `frenchTitle` field to Claude response schema for French title generation
- Updated prompt to request French titles, justifications, and rejection reasons
- Updated examples in prompt with `frenchTitle` field
- Modified `AnalysisResult` and `ScoredPost` interfaces to include `frenchTitle`
- Modified analyzer to extract and propagate `frenchTitle`
- Modified publisher to use `frenchTitle` for Notion page titles
- All 111 tests pass
- TypeScript compilation successful
- **Manual testing on 2-3 real posts still required** before marking Ready for Review

### File List

- `prompts/benjamin-profile.md` (modified) - Added "Langue de Sortie" section + frenchTitle in examples
- `src/config/schema.ts` (modified) - Added frenchTitle to claudeResponseSchema
- `src/types/posts.ts` (modified) - Added frenchTitle to AnalysisResult and ScoredPost
- `src/analyzer/index.ts` (modified) - Updated buildPrompt and parsing to include frenchTitle
- `src/publisher/index.ts` (modified) - Use frenchTitle for Notion titles
- `src/publisher/notion-formatter.ts` (modified) - Use frenchTitle in buildNotionProperties
- `tests/integration/analyzer.test.ts` (modified) - Added frenchTitle to mock responses
- `tests/integration/publisher.test.ts` (modified) - Added frenchTitle to mocks, updated assertions
- `tests/integration/pipeline.test.ts` (modified) - Added frenchTitle to mock data
- `tests/unit/selector.test.ts` (modified) - Added frenchTitle to mock helper
- `tests/unit/notion-formatter.test.ts` (modified) - Added frenchTitle to mocks, updated tests

---

## QA Results

_To be filled by QA agent_
