# Story 2.2: Benjamin Profile Prompt

## Status

Done

## Story

**As a** developer,
**I want** a structured prompt file containing the "Profil Benjamin" criteria,
**so that** Claude can filter posts according to editorial guidelines.

## Acceptance Criteria

1. Un fichier `prompts/benjamin-profile.md` contient le prompt système complet
2. Le prompt inclut les critères pondérés (dramas ⭐⭐⭐, success stories ⭐⭐⭐, etc.)
3. Le prompt inclut les anti-critères (trop technique, corporate sans angle humain, etc.)
4. Le prompt demande un score de 1-10 et une justification courte
5. Le prompt spécifie le format de sortie attendu (JSON structuré)
6. Le fichier prompt est chargé dynamiquement au runtime

## Tasks / Subtasks

- [x] Task 1: Créer le dossier prompts (AC: 1)

  - [x] Créer `prompts/` à la racine du projet

- [x] Task 2: Rédiger le prompt Benjamin Profile (AC: 1, 2, 3, 4, 5)

  - [x] Créer `prompts/benjamin-profile.md`
  - [x] Section contexte : qui est Benjamin, son audience
  - [x] Section critères pondérés avec étoiles
  - [x] Section anti-critères
  - [x] Section format de sortie JSON attendu
  - [x] Exemples de scoring

- [x] Task 3: Implémenter le loader de prompt (AC: 6)

  - [x] Créer `src/analyzer/prompt-loader.ts`
  - [x] Implémenter `loadPrompt(filename: string): string`
  - [x] Gérer les erreurs si fichier non trouvé
  - [x] Cacher le prompt en mémoire après premier chargement

- [x] Task 4: Intégrer le prompt dans l'analyzer (AC: 6)

  - [x] Modifier `src/analyzer/index.ts` pour utiliser le prompt loader
  - [x] Construire le message final avec post + prompt

- [x] Task 5: Écrire les tests
  - [x] Créer `tests/unit/prompt-loader.test.ts`
  - [x] Tester le chargement du fichier
  - [x] Tester l'erreur si fichier manquant
  - [x] Tester le cache

## Dev Notes

### Dépendances Stories Précédentes

Cette story dépend de :

- **Story 2.1 (Claude API Integration)** — module analyzer existant

### Structure du Prompt

Le prompt doit être structuré pour guider Claude à :

1. Comprendre le contexte (Benjamin = créateur tech YouTube français)
2. Évaluer selon des critères pondérés
3. Retourner un JSON structuré

### Critères Pondérés (à inclure dans le prompt)

```markdown
## Critères de Pertinence (score positif)

### ⭐⭐⭐ Très Pertinent (score +3)

- Drama tech / polémiques développeurs
- Success stories de créateurs/entrepreneurs tech
- Actualités IA grand public (pas trop technique)
- Tendances qui impactent les développeurs français

### ⭐⭐ Pertinent (score +2)

- Nouvelles technologies accessibles
- Débats communautaires (langages, frameworks)
- Carrière dev / reconversion

### ⭐ Légèrement Pertinent (score +1)

- Open source populaire
- Outils de productivité dev
- Culture geek mainstream
```

### Anti-Critères (à inclure dans le prompt)

```markdown
## Anti-Critères (score négatif ou rejet)

### ❌ Rejet Immédiat

- Contenu trop technique (algorithmes pointus, papers académiques)
- Corporate PR sans angle humain
- Crypto/Web3 (sauf drama majeur)
- Contenu en français (Benjamin couvre l'actu anglophone)

### ⚠️ Score Réduit (-2)

- Annonces produit sans impact communautaire
- Tutoriels basiques
- Self-promotion évidente
```

### Format de Sortie JSON Attendu

```json
{
  "score": 8,
  "justification": "Drama autour de la mass layoff chez X, sujet qui touche la communauté dev française.",
  "tags": ["drama", "layoffs", "big-tech"],
  "rejected": false,
  "rejectionReason": null
}
```

### Source Tree [Source: architecture/source-tree.md]

```
prompts/
└── benjamin-profile.md       # Ce fichier à créer

src/
├── analyzer/
│   ├── index.ts              # Utilise prompt-loader
│   └── prompt-loader.ts      # Ce fichier à créer
tests/
├── unit/
│   └── prompt-loader.test.ts
```

### Prompt Loader Interface

```typescript
// src/analyzer/prompt-loader.ts
let cachedPrompt: string | null = null;

export function loadPrompt(filename: string): string {
  if (cachedPrompt) return cachedPrompt;

  const promptPath = path.join(process.cwd(), "prompts", filename);
  cachedPrompt = fs.readFileSync(promptPath, "utf-8");
  return cachedPrompt;
}

export function clearPromptCache(): void {
  cachedPrompt = null;
}
```

## Testing

### Standards [Source: architecture/test-strategy-and-standards.md]

- **Framework:** Vitest 2.0
- **Location:** `tests/unit/prompt-loader.test.ts`
- **Pattern:** AAA (Arrange, Act, Assert)

**Tests requis:**

1. Charge correctement un fichier prompt existant
2. Throw erreur si fichier n'existe pas
3. Cache le prompt après premier chargement
4. clearPromptCache() vide le cache

## Change Log

| Date       | Version | Description             | Author            |
| ---------- | ------- | ----------------------- | ----------------- |
| 2025-12-10 | 0.1     | Initial draft           | SM Agent (Bob)    |
| 2025-12-11 | 1.0     | Implementation complete | Dev Agent (James) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

None

### Completion Notes List

- Created `prompts/` directory and `prompts/benjamin-profile.md` with full scoring criteria
- Implemented `src/analyzer/prompt-loader.ts` with caching and error handling
- Exported `loadPrompt` and `clearPromptCache` from `src/analyzer/index.ts`
- Created comprehensive unit tests (6 tests, all passing)
- All linting passes, TypeScript compiles without errors

### File List

- `prompts/benjamin-profile.md` (created)
- `src/analyzer/prompt-loader.ts` (created)
- `src/analyzer/index.ts` (modified - added exports)
- `tests/unit/prompt-loader.test.ts` (created)

---

## QA Results

_To be filled by QA agent_
